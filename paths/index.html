
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <link rel="canonical" href="http://tricksterproxy.io/paths/">
      
      
      <link rel="shortcut icon" href="../images/logos/trickster-logo.svg">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.0.2">
    
    
      
        <title>Customizing HTTP Path Behavior - Trickster</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.38780c08.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f72e892.min.css">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#customizing-http-path-behavior" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="http://tricksterproxy.io/" title="Trickster" class="md-header-nav__button md-logo" aria-label="Trickster">
      
  <img src="../images/logos/trickster-logo.svg" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Trickster
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Customizing HTTP Path Behavior
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/tricksterproxy/trickster/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    tricksterproxy/trickster
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="http://tricksterproxy.io/" title="Trickster" class="md-nav__button md-logo" aria-label="Trickster">
      
  <img src="../images/logos/trickster-logo.svg" alt="logo">

    </a>
    Trickster
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/tricksterproxy/trickster/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    tricksterproxy/trickster
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      Welcome to MkDocs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../caches/" class="md-nav__link">
      Cache Options
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../clickhouse/" class="md-nav__link">
      ClickHouse Support
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../collapsed-forwarding/" class="md-nav__link">
      Collapsed Forwarding
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../configuring/" class="md-nav__link">
      Configuring Trickster
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../health/" class="md-nav__link">
      Health Checks
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../influxdb/" class="md-nav__link">
      InfluxDB Support
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../metrics/" class="md-nav__link">
      Trickster Metrics
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../multi-origin/" class="md-nav__link">
      Using Multiple-Origins with a single Trickster instance
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../negative-caching/" class="md-nav__link">
      Negative Caching
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../new-changed-1.1/" class="md-nav__link">
      Trickster 1.1
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Customizing HTTP Path Behavior
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Customizing HTTP Path Behavior
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#path-matching-scope" class="md-nav__link">
    Path Matching Scope
  </a>
  
    <nav class="md-nav" aria-label="Path Matching Scope">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#method-matching-scope" class="md-nav__link">
    Method Matching Scope
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#suggested-use-cases" class="md-nav__link">
    Suggested Use Cases
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#request-rewriters" class="md-nav__link">
    Request Rewriters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#header-and-query-parameter-behavior" class="md-nav__link">
    Header and Query Parameter Behavior
  </a>
  
    <nav class="md-nav" aria-label="Header and Query Parameter Behavior">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basics" class="md-nav__link">
    Basics
  </a>
  
    <nav class="md-nav" aria-label="Basics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting" class="md-nav__link">
    Setting
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appending" class="md-nav__link">
    Appending
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#removing" class="md-nav__link">
    Removing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-header-timing" class="md-nav__link">
    Response Header Timing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache-key-components" class="md-nav__link">
    Cache Key Components
  </a>
  
    <nav class="md-nav" aria-label="Cache Key Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-request-body-fields-in-cache-key-hashing" class="md-nav__link">
    Using Request Body Fields in Cache Key Hashing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-reverse-proxy-cache-config-with-path-customizations" class="md-nav__link">
    Example Reverse Proxy Cache Config with Path Customizations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modifying-behavior-of-time-series-origin-types" class="md-nav__link">
    Modifying Behavior of Time Series Origin Types
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../per-query-instructions/" class="md-nav__link">
      Per-Query Time Series Instructions
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../placement/" class="md-nav__link">
      Where to Place Trickster
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../promsim/" class="md-nav__link">
      PromSim Update
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../range_request/" class="md-nav__link">
      Byte Range Request Support
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../request_rewriters/" class="md-nav__link">
      Request Rewriters
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../retention/" class="md-nav__link">
      Trickster Caching Retention Policies
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../roadmap/" class="md-nav__link">
      Trickster Roadmap
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../rule/" class="md-nav__link">
      Rule Origin
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../supported-origin-types/" class="md-nav__link">
      Supported Origin Types
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../tls/" class="md-nav__link">
      TLS Support
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../tracing/" class="md-nav__link">
      Distributed Tracing via OpenTelemetry
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-24" type="checkbox" id="nav-24">
    
    <label class="md-nav__link" for="nav-24">
      Developer
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Developer" data-md-level="1">
      <label class="md-nav__title" for="nav-24">
        <span class="md-nav__icon md-icon"></span>
        Developer
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../developer/adding-new-config/" class="md-nav__link">
      Adding a New Configuration Value
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../developer/origin-extensibility/" class="md-nav__link">
      Extending Trickster to Support a New Origin Type
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../developer/spinning-new-release/" class="md-nav__link">
      Spinning New Trickster Release
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../developer/tracing/" class="md-nav__link">
      Tracing support
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#path-matching-scope" class="md-nav__link">
    Path Matching Scope
  </a>
  
    <nav class="md-nav" aria-label="Path Matching Scope">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#method-matching-scope" class="md-nav__link">
    Method Matching Scope
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#suggested-use-cases" class="md-nav__link">
    Suggested Use Cases
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#request-rewriters" class="md-nav__link">
    Request Rewriters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#header-and-query-parameter-behavior" class="md-nav__link">
    Header and Query Parameter Behavior
  </a>
  
    <nav class="md-nav" aria-label="Header and Query Parameter Behavior">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basics" class="md-nav__link">
    Basics
  </a>
  
    <nav class="md-nav" aria-label="Basics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting" class="md-nav__link">
    Setting
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appending" class="md-nav__link">
    Appending
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#removing" class="md-nav__link">
    Removing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-header-timing" class="md-nav__link">
    Response Header Timing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache-key-components" class="md-nav__link">
    Cache Key Components
  </a>
  
    <nav class="md-nav" aria-label="Cache Key Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-request-body-fields-in-cache-key-hashing" class="md-nav__link">
    Using Request Body Fields in Cache Key Hashing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-reverse-proxy-cache-config-with-path-customizations" class="md-nav__link">
    Example Reverse Proxy Cache Config with Path Customizations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modifying-behavior-of-time-series-origin-types" class="md-nav__link">
    Modifying Behavior of Time Series Origin Types
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/tricksterproxy/trickster/edit/master/docs/paths.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="customizing-http-path-behavior">Customizing HTTP Path Behavior</h1>
<p>Trickster supports, via configuration, customizing the upstream request and downstream response behavior on a per-Path, per-Origin basis, by providing a <code>paths</code> configuration section for each origin configuration. Here are the basic capabilities for customizing Path behavior:</p>
<ul>
<li>Modify client request headers prior to contacting the origin while proxying</li>
<li>Modify origin response headers prior to processing the response object in Trickster and delivering to the client</li>
<li>Modify the response code and body</li>
<li>Limit the scope of a path by HTTP Method</li>
<li>Select the HTTP Handler for the path (<code>proxy</code>, <code>proxycache</code> or a published origin-type-specific handler)</li>
<li>Select which HTTP Headers, URL Parameters and other client request characteristics will be used to derive the Cache Key under which Trickster stores the object.</li>
<li>Disable Metrics Reporting for the path</li>
</ul>
<h2 id="path-matching-scope">Path Matching Scope</h2>
<p>Paths are matchable as <code>exact</code> or <code>prefix</code></p>
<p>The default match is <code>exact</code>, meaning the client's requested URL Path must be an exact match to the configured path in order to match and be handled by a given Path Config. For example a request to <code>/foo/bar</code> will not match an <code>exact</code> Path Config for <code>/foo</code>.</p>
<p>A <code>prefix</code> match will match any client-requested path to the Path Config with the longest prefix match. A <code>prefix</code> match Path Config to <code>/foo</code> will match <code>/foo/bar</code> as well as <code>/foobar</code> and <code>/food</code>. A basic string match is used to evaluate the incoming URL path, so it is recommended to consider finishing paths with a trailing <code>/</code>, like <code>/foo/</code> in Path Configurations, if needed to avoid any unintentional matches.</p>
<h3 id="method-matching-scope">Method Matching Scope</h3>
<p>The <code>methods</code> section of a Path Config takes a string array of HTTP Methods that are routed through this Path Config. You can provide <code>[ '*' ]</code> to route all methods for this path.</p>
<h2 id="suggested-use-cases">Suggested Use Cases</h2>
<ul>
<li>Redirect a path by configuring Trickster to respond with a <code>302</code> response code and a <code>Location</code> header</li>
<li>Issue a blanket <code>401 Unauthorized</code> code and custom response body to all requests for a given path.</li>
<li>Adjust Cache Control headers in either direction</li>
<li>Affix an Authorization header to requests proxied out by Trickster.</li>
<li>Control which paths are cached by Trickster, and which ones are simply proxied.</li>
</ul>
<h2 id="request-rewriters">Request Rewriters</h2>
<p>You can configure paths send inbound requests through a request rewriter that can modify any aspect of the inbound request (method, url, headers, etc.), before being processed by the path route. This means, when the path route inspects the request, it will have already been modified by the rewriter. Provide a rewriter with the <code>req_rewriter_name</code> config. It must map to a named/configured request rewriter (see <a href="../request_rewriters/">request rewriters</a> for more info). Note, you can also send requests through a rewriter at the origin level. If both are configured, origin-level rewriters are executed before path rewriters are.</p>
<pre><code class="language-toml">
[request_rewriters]
    # this example request rewriter adds an additional header to the request
    [request_rewriters.example]
        instructions = [
            [&quot;header&quot;, &quot;set&quot;, &quot;Example-Header-Name&quot;, &quot;Example Value&quot;]
        ]

[origins]

    [origins.default]
    provider = 'rpc'
    origin_url = 'http://example.com'

        [origins.default.paths]
            [origins.default.paths.root]
            path = '/'
            req_rewriter_name = 'example'
</code></pre>
<h2 id="header-and-query-parameter-behavior">Header and Query Parameter Behavior</h2>
<p>In addition to running the request through a named rewriter, it is currently possible to make similar changes to the request with legacy path features that are described in this section. Note that these are likely to be deprecated in a future Trickster release, in favor of the more versatile named rewriters described above, which accomplish the same thing. Currently, if both a named rewriter and legacy path-based rewriting configs are defined for a given path, the named rewriter will be executed first.</p>
<h3 id="basics">Basics</h3>
<p>You can specify request query parameters, as well as request and response headers, to be Set, Appended or Removed.</p>
<h4 id="setting">Setting</h4>
<p>To Set a header or parameter means to insert if non-existent, or fully replace if pre-existing. To set a header, provide the header name and value you wish to set in the Path Config <code>request_params</code>, <code>request_headers</code> or <code>response_headers</code> sections, in the format of <code>'Header-or-Parameter-Name' = 'Value'</code>.</p>
<p>As an example, if the client request provides a <code>Cache-Control: no-store</code> header, a Path Config with a header 'set' directive for <code>'Cache-Control' = 'no-transform'</code> will replace the <code>no-store</code> entirely with a <code>no-transform</code>; client requests that have no <code>Cache-Control</code> header that are routed through this Path will have the Trickster-configured header injected outright. The same logic applies to query parameters.</p>
<h4 id="appending">Appending</h4>
<p>Appending a means inserting the header or parameter if it doesn't exist, or appending the configured value(s) into a pre-existing header with the given name. To indicate an append behavior (as opposed to set), prefix the header or parameter name with a '+' in the Path Config.</p>
<p>Example: if the client request provides a <code>token=SomeHash</code> parameter and the Path Config includes the parameter <code>'+token' = 'ProxyHash'</code>, the effective parameter when forwarding the request to the origin will be <code>token=SomeHash&amp;token=ProxyHash</code>.</p>
<h4 id="removing">Removing</h4>
<p>Removing a header or parameter means to strip it from the HTTP Request or Response when present. To do so, prefix the header/parameter name with '-', for example, <code>-Cache-control: none</code>. When removing headers, a value is required to be provided in order to conform to TOML specification; this value, however, is innefectual. Note that there is currently no ability to remove a specific header value from a specific header - only the entire removal header. Consider setting the header value outright as described above, to strip any unwanted values.</p>
<h4 id="response-header-timing">Response Header Timing</h4>
<p>Response Header injections occur as the object is received from the origin and before Trickster handles the object, meaning any caching response headers injected by Trickster will also be used by Trickster immediately to handle caching policies internally. This allows users to override cache controls from upstream systems if necessary to alter the actual caching behavior inside of Trickster. For example, InfluxDB sends down a <code>Cache-Control: No-Cache</code> header, which is fine for the user's browser, but Trickster needs to ignore this header in order to accelerate InfluxDB; so the default Path Configs for InfluxDB actually removes this header.</p>
<h3 id="cache-key-components">Cache Key Components</h3>
<p>By default, Trickster will use the HTTP Method, URL Path and any Authorization header to derive its Cache Key. In a Path Config, you may specify any additional HTTP headers and URL Parameters to be used for cache key derivation, as well as information in the Request Body.</p>
<h4 id="using-request-body-fields-in-cache-key-hashing">Using Request Body Fields in Cache Key Hashing</h4>
<p>Trickster supports the parsing of the HTTP Request body for the purpose of deriving the Cache Key for a cacheable object. Note that body parsing requires reading the entire request body into memory and parsing it before operating on the object. This will result in slightly higher resource utilization and latency, depending upon the size of the client request body.</p>
<p>Body parsing is supported when the request's HTTP method is <code>POST</code>, <code>PUT</code> or <code>PATCH</code>, and the request <code>Content-Type</code> is either <code>application/x-www-form-urlencoded</code>, <code>multipart/form-data</code>, or <code>application/json</code>.</p>
<p>In a Path Config, provide the <code>cache_key_form_fields</code> setting with a list of form field names to include when hashing the cache key.</p>
<p>Trickster supports parsing of the Request body as a JSON document, including documents that are multiple levels deep, using a basic pathing convention of forward slashes, to indicate the path to a field that should be included in the cache key. Take the following JSON document:</p>
<pre><code class="language-json">{
    &quot;requestType&quot;: &quot;query&quot;,
    &quot;query&quot;: {
        &quot;table&quot;: &quot;movies&quot;,
        &quot;fields&quot;: &quot;eidr,title&quot;,
        &quot;filter&quot;: &quot;year=1979&quot;
    }
}
</code></pre>
<p>To include the <code>requestType</code>, <code>table</code>, <code>fields</code>, and <code>filter</code> fields from this document when hashing the cache key, you can provide the following setting in a Path Configuration:</p>
<p><code>cache_key_form_fields = [ 'requestType', 'query/table', 'query/fields', 'query/filter' ]</code></p>
<h2 id="example-reverse-proxy-cache-config-with-path-customizations">Example Reverse Proxy Cache Config with Path Customizations</h2>
<pre><code class="language-toml">[origins]

    [origins.default]
    provider = 'rpc'

        [origins.default.paths]

            # root path '/'. Paths must be uniquely named but the
            # name is otherwise unimportant
            [origins.default.paths.root]
            path = '/' # each path must be unique for the origin
            methods = [ '*' ] # All HTTP methods applicable to this config
            match_type = 'prefix' # matches any path under '/'
            handler = 'proxy' # proxy only, no caching (this is the default)

                # modify the query parameters en route to the origin
                [origins.default.paths.root.request_params]
                'authToken' = 'secret string'

                # When a user requests a path matching this route, Trickster will
                # inject these headers into the request before contacting the Origin
                [origins.default.paths.root.request_headers]
                'Cache-Control' = 'No-Transform' # Due to hyphens, quote the key name

                # inject these headers into the response from the Origin
                # before replying to the client
                [origins.default.paths.root.response_headers]
                'Expires' = '-1'

            [origins.default.paths.images]
            path = '/images/'
            methods = [ 'GET', 'HEAD' ]
            handler = 'proxycache' # Trickster will cache the images directory
            match_type = 'prefix'

                [origins.default.paths.images.response_headers]
                'Cache-Control' = 'max-age=2592000' # cache for 30 days

            # but only cache this rotating image for 30 seconds
            [origins.default.paths.images_rotating]
            path = '/images/rotating.jpg'
            methods = [ 'GET' ]
            handler = 'proxycache'
            match_type = 'exact'

                [origins.default.paths.images_rotating.response_headers]
                'Cache-Control' = 'max-age=30'
                '-Expires' = '

            # redirect this sunsetted feature to a discontinued message
            [origins.default.paths.redirect]
            path = '/blog'
            methods = [ '*' ]
            handler = 'localresponse'
            match_type = 'prefix'
            response_code = 302

                [origins.default.paths.redirect.response_headers]
                Location = '/discontinued'

            # cache this API endpoint, keying on the query parameter
            [origins.default.paths.api]
            path = '/api/'
            methods = [ 'GET', 'HEAD' ]
            handler = 'proxycache'
            match_type = 'prefix'
            cache_key_params = [ 'query' ]

            # same API endpoint, different HTTP methods to route against
            [origins.default.paths.api-deny]
            path = '/api/'
            methods = [ 'POST', 'PUT', 'PATCH', 'DELETE', 'OPTIONS', 'CONNECT' ]
            handler = 'localresponse'
            match_type = 'prefix'
            response_code = 401
            response_body = 'this is a read-only api endpoint'

            # cache the query endpoint, permitting GET or POST
            [origins.default.paths.api-query]
            path = '/api/query/'
            methods = [ 'GET', 'HEAD', 'POST' ]
            handler = 'proxycache'
            match_type = 'prefix'
            cache_key_params = [ 'query' ]       # for GET / HEAD
            cache_key_form_fields = [ 'query' ]  # for POST
</code></pre>
<h2 id="modifying-behavior-of-time-series-origin-types">Modifying Behavior of Time Series Origin Types</h2>
<p>Each of the Time Series Origin Types supported in Trickster comes with its own custom handlers and pre-defined Path Configs that are registered with the HTTP Router when Trickster starts up.</p>
<p>For example, when Trickster is configured to accelerate Prometheus, pre-defined Path Configs are registered to control how requests to <code>/api/v1/query</code> work differently from requests to <code>/api/v1/query_range</code>. For example, the <code>/ap1/v1/query</code> Path Config uses the <code>query</code> and <code>time</code> URL query qarameters when creating the cache key, and is routed through the Object Proxy Cache; while the <code>/api/v1/query_range</code> Path Config uses the <code>query</code>, <code>start</code>, <code>end</code> and <code>step</code> parameters, and is routed through the Time Series Delta Proxy Cache.</p>
<p>In the Trickster config file, you can add your own Path Configs to your time series origin, as well override individual settings for any of the pre-defined Path Configs, and those custom settings will be applied at startup.</p>
<p>To know what configs you'd like to add or modify, take a look at the Trickster source code and examine the pre-definitions for the selected Origin Type. Each supported Origin Type's handlers and default Path Configs can be viewed under <code>/internal/proxy/origins/&lt;origin_type&gt;/routes.go</code>. These files are in a standard format that are quite human-readable, even for a non-coder, so don't be too intimidated. If you can understand Path Configs as TOML, you can understand them as Go code.</p>
<p>Examples of customizing Path Configs for Origin Types with Pre-Definitions:</p>
<pre><code class="language-toml">[origins]

    [origins.default]
    provider = 'prometheus'

        [origins.default.paths]

            # route /api/v1/label* (including /labels/*)
            # through Proxy instead of ProxyCache as pre-defined
            [origins.default.paths.label]
            path = '/api/v1/label'
            methods = [ 'GET' ]
            match_type = 'prefix'
            handler = 'proxy'

            # route fictional new /api/v1/coffee to ProxyCache
            [origins.default.paths.series_range]
            path = '/api/v1/coffee'
            methods = [ 'GET' ]
            match_type = 'prefix'
            handler = 'proxycache'
            cache_key_params = [ 'beans' ]

            # block /api/v1/admin/ from being reachable via Trickster
            [origins.default.paths.admin]
            path = '/api/v1/admin/'
            methods = [ 'GET', 'POST', 'PUT', 'HEAD', 'DELETE', 'OPTIONS' ]
            match_type = 'prefix'
            handler = 'localresponse'
            response_code = 401
            response_body = 'No soup for you!'
            no_metrics = true
</code></pre>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../new-changed-1.1/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Trickster 1.1
              </div>
            </div>
          </a>
        
        
          <a href="../per-query-instructions/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Per-Query Time Series Instructions
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.77e55a48.min.js"></script>
      <script src="../assets/javascripts/bundle.9554a270.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>